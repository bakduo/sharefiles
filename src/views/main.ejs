<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="csrf-token" content="<%= csrfToken %>">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>

    <title>Testing Upload file</title>
</head>

<body>

  <center><h2>Sharefiles</h2><center>

    <form  id="formUpload" enctype="multipart/form-data" action="/uploadfilescheck" method="post">
 
        <div class="form-group">
          <label for="archivos">archivouser</label>
          <input type="file" class="form-control" name="archivosuser" id="archivouser" multiple>
        </div>

        


    </form>

    <input type="Submit" id="enviarfile" onclick="enviarFile()" class="btn btn-primary" value="Submit"/>

    <br>
    <hr>
    <script>


            function enviarFile(){
                const token = document.querySelector('meta[name="csrf-token"]').getAttribute('content');

                let input = document.querySelector('input[type="file"]')

                let data = new FormData();
                for (const file of input.files) {
                    data.append('archivosuser',file,file.name)
                }

                            // Make a request using the Fetch API
                fetch('/uploadfilescheck', {
                credentials: 'same-origin', // <-- includes cookies in the request
                headers: {
                    'CSRF-Token': token // <-- is the csrf token as a header
                },
                method: 'POST',
                body:data
                });

            }
            
            

    </script>

</body>

</html>